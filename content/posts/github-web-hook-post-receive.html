<p>One of the problems using a 3rd-party repository hosting service is you don&#8217;t have access to the remote repository and thus it&#8217;s not straightforward to setup and use the remote hooks, like Post-Receive. (For a detailed explanation of the different git hooks, you can read <a href="http://book.git-scm.com/5_git_hooks.html">this page</a> from the <a href="http://book.git-scm.com/index.html">git community book</a>.)</p>
<p>Post-Receive is a hook that you can use for packaging or deploying etc and is triggered after all the refs have been updated (on successful &#8216;git push&#8217;).</p>
<p>Github allows you to setup a &#8216;Webhook&#8217; that is executed on Post-Receive. You should read <a href="http://help.github.com/post-receive-hooks/">this page</a> to get a basic idea on how to set up the webhook.</p>
<p>Once the post-receive web hook is POSTing to the correct location, you need to munge the POST data.</p>
<p>I&#8217;ve created a simple PHP + Bash script that shows the general logic of deploying and archiving a repository on post-receive.</p>
<p>This bit of PHP code will simply decode the POSTed JSON data, determine if the commits have been pushed to the master branch, then execute a BASH build script as a background process.</p>
<pre class="prettyprint lang-php linenums">&lt;?php<br/><br/>        // Turn off error reporting<br/>        error_reporting(0);<br/><br/>        try<br/>        {<br/>                // Decode the payload json string<br/>                $payload = json_decode($_REQUEST['payload']);<br/>        }<br/>        catch(Exception $e)<br/>        {<br/>                exit;<br/>        }<br/><br/>        // Pushed to master?<br/>        if ($payload-&gt;ref === 'refs/heads/master')<br/>        {<br/>                // Log the payload object<br/>                @file_put_contents('logs/github.txt', print_r($payload, TRUE), FILE_APPEND);<br/><br/>                // Prep the URL - replace https protocol with git protocol to prevent 'update-server-info' errors<br/>                $url = str_replace('https://', 'git://', $payload-&gt;repository-&gt;url);<br/><br/>                // Run the build script as a background process<br/>                `./build.sh {$url} {$payload-&gt;repository-&gt;name} &gt; /dev/null 2&gt;&amp;1 &amp;`;<br/>        }<br/>?&gt;<br/></pre>
<p>The following bash script (build.sh) will build archive of the repository using the latest files from the repo. The following parameters are expected:</p>
<pre>$1: repository url<br/>$2: repository name</pre>
<p>It clones the repo to get the latest files, updates the repo submodules, archives the repo then removes the repo files.</p>
<pre class="prettyprint lang-shell linenums">#! /usr/bin/env bash<br/># filename: build.sh<br/><br/>#clone the repo<br/>git clone -q "${1}" "clones/${2}"<br/><br/>cd "clones/${2}"<br/><br/>#update the submodules (how do we handle errors here?)<br/>git submodule --quiet update --init --recursive<br/><br/>cd ../../<br/><br/>#tar up the directory<br/>tar --exclude=.git -cf "archives/${2}-master.tar" "clones/${2}"<br/><br/>#remove the cloned repo<br/>rm -rf "clones/${2}"<br/><br/>echo "A new archive has been created at /archives/${2}-master.tar" | mail -s 'Github project build successul!' 'your@email.com'<br/></pre>
<p>I use a similar script to package some of my projects hosted on github. This is incredibly useful as it will update the submodules (downloaded github repos will not include the submodule repos.)</p>