<p>Data validation is important and ensures the data you are storing is  in the format you expect it to be. This is much easier said than done  though. <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a> prevention is a good example of the reasons for data validation, but it can be a total pig to get right.</p>
<h3>Email string patterns</h3>
<p>Throughout my development life I&#8217;ve seen all types of email regex  patterns with varying differences. This has always caused conflict for  me as I&#8217;ve never entirely understood what they&#8217;re validating against.  How do we define what is valid and what isn&#8217;t? I think email validation  is VERY important, the last thing you want is to prevent a person from  registering an account or purchasing a product because their email  address is not accepted.</p>
<h3>The right pattern?</h3>
<p>So then, in order to get email validation done right, we first need  to understand what  actually is a valid email address. Most people would  think it would be an alpha-numeric string (that might contain dashes,  underscores and/or periods), followed by @, followed by a domain string  that contains a period. Actually, an email address is not so restricted.  Enter the <a href="http://www.w3.org/Protocols/rfc822/">RFC822: Standard for ARPA Internet Text Messages</a>.  I think it&#8217;s safe to say this is the official spec for validating email  address. Few sane people would have the patience to read through the  spec, but people have already done it (naturally), so lets take a look  at some of the implementations of this spec.</p>
<h3>RFC822 implementation example</h3>
<p>First up, lets have a look at a PHP implementation. I use the <a href="http://kohanaframework.org/">Kohana PHP framework</a>, and I think the guys developing it are super smart, so lets see their implementation. Have a <a href="https://github.com/kohana/core/blob/fe2bc5924ebae5fa514d5f2bd7e58aff90b8c7ca/classes/kohana/validate.php#L101-135">look here</a>. It&#8217;s pretty hard to reverse-engineer those regular expression patterns, but this a well tested implementation that works.</p>
<p>My initial plan was to use the same pattern and port it to  Javascript, but I shortly gave up on that idea. A quick google search  brought up <a href="http://rosskendall.com/blog/web/javascript-function-to-check-an-email-address-conforms-to-rfc822">this post</a>.  This is the Javascript version of the original PHP version that Kohana  used. Great! But I didn&#8217;t like the format of the code, I didn&#8217;t care for  understanding the implementation. (If the implementation has been done  correctly, I should never have the need to understand it. - I&#8217;m lazy.)</p>
<p>So all I have done is simplified Ross Kendall&#8217;s code, and have produced this:</p>
<p>(Licensed under a Creative Commons Attribution-ShareAlike 2.5  License, or the GPL) If you use this code you must include the original  copyright as <a href="http://rosskendall.com/files/rfc822validemail.js.txt">stated here</a>.</p>
<pre class="prettyprint lang-javascript">function isEmail(email){<br/>        return /^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/.test( email );<br/>}<br/></pre>
<p><a href="http://demos.badsyntax.co/javascript-rfc822-email-validation.html">View a demo</a> of this function in action. This mad fucking regex pattern is used to  validate email address that conform to the RFC822 specification. This is  how email validation should be done, in my opinion.</p>
<h3>The spec isn&#8217;t &#8216;real world&#8217;</h3>
<p>If you look back at the <a href="https://github.com/kohana/core/blob/fe2bc5924ebae5fa514d5f2bd7e58aff90b8c7ca/classes/kohana/validate.php#L101-135">Kohana implementation</a>,  you&#8217;ll notice they have two methods of validating an email adress. One  that validates against the RFC822 spec, and another &#8216;random&#8217; regex. I  queried this in the Kohana 3 forums. <a href="http://forum.kohanaframework.org/discussion/7462/email-validation-rfc822">Read the responses</a>.  So yea, context is everything. Personally, I don&#8217;t want to have to  worry about it, and will continue using the &#8216;loose&#8217; RFC822 spec  implementation, because I do not want to disallow valid emails, and it&#8217;s  difficult to trust an &#8216;opinionated regex&#8217;.</p>
<h3>RFC2822</h3>
<p>Elsewhere, you have the <a href="https://github.com/jzaefferer/jquery-validation">jQuery validate plugin</a> using a regex that <a href="http://scottgonzalez.com/">Scott Gonz√°lez </a>created, <a href="http://projects.scottsplayground.com/email_address_validation/lib/email.js">see here</a>. That regex conforms to the <a href="http://www.ietf.org/rfc/rfc2822.txt">RFC2822 spec</a>,  which supersedes the 822 spec to &#8216;reflect current practice and  incorporating incremental changes that were specified in other RFCs&#8217;, so  it&#8217;s probably a safer option. I&#8217;m just less familiar with that spec,  and am too lazy to understand the differences.</p>
<h3>Don&#8217;t validate</h3>
<p>Unless you&#8217;re following the spec(s), I suggest not doing any sort of  email validation (by using regular expressions). The best way to do it,  imo, is to allow the user to re-enter their email address (to ensure  they&#8217;ve entered it correctly), and then send a verification email, and  let the MTA deal with the valid/invalid address.</p>
<h3>Conclusion</h3>
<p>Please take everything I have said in this post with a pinch of salt,  and make up your mind about this. I still come across conflicting  opinions from respected sources as to the best way to do it. I choose to  follow the spec because of this conflicting information. For a more  detailed explanation of the pros and cons of following the spec, please <a href="http://www.regular-expressions.info/email.html">read this article</a>.</p>